<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:tal="http://xml.zope.org/namespaces/tal">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>TLeave</title>
<meta name="keywords" content="python web application mbta commuter rail train schedule" />
<meta name="description" content="An alternative MBTA Commuter Rail schedule" />
<script src="http://code.jquery.com/jquery-1.5.2.min.js"></script>
<script src="${request.application_url}/static/jquery.selectboxes.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">

  var empty_request = ${len(request.params)} == 0; 

    $(function(){
      $('#route').change(function(){
        selectedroute = $('#route :selected').val();
        updateStationList(selectedroute);
      })

      $('#timing').change(function(){
        timing = $('#timing :selected').val();
        setTimeout('$("#station_search").submit()', 800);
      })

    }
    ) 

    //this resets the menu on page load
    $(function(){
      $(document).ready(function(){
        if(empty_request){ 
          selectedroute = $('#route :selected').val();
          updateStationList(selectedroute);
        }
      })
    })

    function updatemenu()
    {
        var el = $(this);
          // sort
            el.selectmenu("refresh");
          }


    function updateStationList(selectedroute){  
      //disable
      $("#show_trains").button("disable");
      $("#stationStart").removeOption(/./);          
      $("#stationStart").ajaxAddOption('${request.application_url}/stationlist',
    {sortorder:'O', route:selectedroute}, false, updatemenu );

      $("#stationEnd").removeOption(/./);          
      $("#stationEnd").ajaxAddOption('${request.application_url}/stationlist',
    {sortorder:'I',route:selectedroute}, false, updatemenu );
      //reenable
      $("#show_trains").button("enable");
    }
                               
</script>

<script type="text/javascript">
  $(document).bind("mobileinit", function(){
  $.mobile.selectmenu.prototype.options.hidePlaceholderMenuItems = false;
    });
</script>
<!-- jquery mobile -->
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a4.1/jquery.mobile-1.0a4.1.min.css" />
<script src="http://code.jquery.com/mobile/1.0a4.1/jquery.mobile-1.0a4.1.min.js"></script>
</head>
<body >

<!-- start page -->
<div id="page" data-role="page">
  <div class="ui-bar ui-bar-c">
    <a href="http://tleave.com">
      <img src="${request.application_url}/static/images/tleave.gif" alt="tleave: Find your next train" />
    </a>
  </div>
  <form action="" method="get" id="station_search" data-ajax="false">
      <label for="route"> choose route </label>
      <input type="hidden" name="form.submitted" value="true" />
      <select name="route" id="route">
        <option tal:repeat="item routes" tal:attributes="value python: item[0]; selected python: str(item[0]) == selectedroute" tal:content="python: item[1] "> </option>
      </select>

      <label for="stationStart"> current stop </label>
      <select name="stationStart" id="stationStart">

        <option tal:repeat="item stationpages" tal:attributes="value python: item.stationname; selected python: item.stationname == stationStart" tal:content="python: item.stationname"> </option>
      </select> 

      <label for="stationEnd"> destination </label>
      <select name="stationEnd" id="stationEnd">
        <option tal:repeat="item stationpages" tal:attributes="value python: item.stationname; selected python: item.stationname == stationEnd" tal:content="python: item.stationname"> </option>
      </select> 

      <label for="timing"> day of the week </label>
      <select name="timing" id="timing">
        <option value="S" tal:attributes="selected python: timing == 'S'">Saturday</option>
        <option value="U" tal:attributes="selected python: timing == 'U'">Sunday</option>
        <option value="W" tal:attributes="selected python: timing == 'W'">Weekday</option>
      </select>
    <input type="submit" data-theme="b" value="show trains" id="show_trains"/>
  </form>

  <br />
  <div tal:condition="alerts">  
    <h4>current service alerts</h4>
    <p id="alerts" tal:content="structure alerts"></p>
  </div> 

  <div class='ui-grid-a' tal:condition="python: len(nexttrain) > 0">

    <div class="ui-block-a">
      <h3>Leaves from

        <span class="stationHeader" tal:content="stationStart"></span>
      </h3>
    </div>
    <div class="ui-block-b">

      <h3> Arrives at

        <span class="stationHeader" tal:content="stationEnd"></span>
      </h3>
    </div>

    <div tal:repeat="times nexttrain">
      <div class="ui-block-a">
        <div class="ui-bar ui-bar-b" style="height:50px">

          <div class="trainNumber">Train number <span tal:content="python: str(times[0].train_num)">Page text goes here.</span></div> 
          <span tal:content="python: str(times[0])">Page text goes here.</span> 
        </div>
      </div>
      <div class="ui-block-b">
        <div class="ui-bar ui-bar-b" style="height:50px"> 
          <span tal:content="python: str(times[1])">Page text goes here.</span> 
        </div>
      </div>
    </div>       
  </div>


  <h1 tal:condition="python: len(nexttrain) is 0">No trains for seleced route</h1>
  <!-- end content -->

  <br />
  <br />
  <strong> Built with </strong>
  <br />
  <a href="http://docs.pylonsproject.org/projects/pyramid/dev/#"><img src="${request.application_url}/static/images/pyramid-small.png" alt="Pyramid web framework. Not built by aliens" /></a>
  <p> by <a href="http://avanderlip.com">avanderlip.com</a></p>
</div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-8151787-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- end page -->
</body>
</html>
